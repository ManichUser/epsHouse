// Schéma Prisma pour Epsilon House
// Base de données: SQLite (local, démo)
// ORM: Prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ========================================
// MODÈLE VILLE
// ========================================
model Ville {
  id        String     @id @default(cuid())
  nom       String     @unique
  latitude  Float      // Position GPS de la ville
  longitude Float
  quartiers Quartier[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@map("villes")
}

// ========================================
// MODÈLE QUARTIER
// ========================================
model Quartier {
  id              String           @id @default(cuid())
  nom             String
  villeId         String
  latitude        Float            // Position GPS du quartier
  longitude       Float
  ville           Ville            @relation(fields: [villeId], references: [id], onDelete: Cascade)
  zones           Zone[]
  bienImmobiliers BienImmobilier[]
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@unique([nom, villeId])
  @@map("quartiers")
}

// ========================================
// MODÈLE ZONE (optionnel)
// ========================================
model Zone {
  id              String           @id @default(cuid())
  nom             String
  quartierId      String
  latitude        Float            // Position GPS de la zone
  longitude       Float
  quartier        Quartier         @relation(fields: [quartierId], references: [id], onDelete: Cascade)
  bienImmobiliers BienImmobilier[]
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@unique([nom, quartierId])
  @@map("zones")
}

// ========================================
// MODÈLE BIEN IMMOBILIER
// ========================================
model BienImmobilier {
  id                 String      @id @default(cuid())
  titre              String
  type               TypeBien
  prix               Int         // Prix en FCFA
  description        String
  superficie         Int?        // Superficie en m²
  nombreChambres     Int?        // Nombre de chambres
  nombreSallesBain   Int?        // Nombre de salles de bain
  meuble             Boolean     @default(false) // Est meublé ?
  latitude           Float       // Position GPS exacte du bien
  longitude          Float
  adresse            String      // Adresse complète
  quartierId         String
  quartier           Quartier    @relation(fields: [quartierId], references: [id], onDelete: Cascade)
  zoneId             String?
  zone               Zone?       @relation(fields: [zoneId], references: [id], onDelete: SetNull)
  images             ImageBien[]
  disponible         Boolean     @default(true) // Disponibilité
  dateDisponibilite  DateTime?   // Date de disponibilité
  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @updatedAt

  @@map("bien_immobiliers")
}

// ========================================
// MODÈLE IMAGE BIEN
// ========================================
model ImageBien {
  id        String         @id @default(cuid())
  url       String         // URL Cloudinary
  publicId  String         // Public ID Cloudinary
  isCover   Boolean        @default(false) // Image principale
  ordre     Int            @default(0) // Ordre d'affichage
  bienId    String
  bien      BienImmobilier @relation(fields: [bienId], references: [id], onDelete: Cascade)
  createdAt DateTime       @default(now())

  @@map("images_bien")
}

// ========================================
// ENUM TYPE DE BIEN
// ========================================
enum TypeBien {
  CHAMBRE
  STUDIO
  APPARTEMENT
}